

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
<<<<<<< HEAD
  <title>adamspy.adripy.event &mdash; adamspy 0.29.8 documentation</title>
=======
  <title>adamspy.adripy.event &mdash; adamspy 0.29.10 documentation</title>
>>>>>>> 4b9165c62d689cf5ae34e79ed1508db859439cad
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> adamspy
          

          
          </a>

          
            
            
              <div class="version">
<<<<<<< HEAD
                0.29.8
=======
                0.29.10
>>>>>>> 4b9165c62d689cf5ae34e79ed1508db859439cad
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">adamspy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>adamspy.adripy.event</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for adamspy.adripy.event</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Contains the DrillEvent class</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">thornpy</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">TMPLT_ENV</span>
<span class="kn">from</span> <span class="nn">.utilities</span> <span class="k">import</span> <span class="n">read_TO_file</span><span class="p">,</span> <span class="n">get_cdb_path</span><span class="p">,</span> <span class="n">get_full_path</span>

<span class="c1"># Configure Logging</span>
<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="DrillEvent"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.event.DrillEvent">[docs]</a><span class="k">class</span> <span class="nc">DrillEvent</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an object with all data necessary to write a drill event.  Once the DrillEvent is instanced ramp parameters must be defined before the DrillEvent is written to an event file.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    After instancing the class, at least one simulation step must be added using the `add_simulation_step()` method. Also, at least one ramp must be added for each of the four drilling parameters (i.e. wob, rpm, gpm, rop) using the `add_ramp()` method.  All other parameters in the event file can be specified when the DrillEvent is instanced using kwargs or they can be set later using:</span>
<span class="sd">        &gt;&gt;&gt; drill_event.parameters[parameter] = value </span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    WOB should be in lbf    </span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        Dictionary of parameters that make up an Adams Drill string and would be found in an Adams Drill String file (.str).  The keys of the dictionary are the parameter names that would be seen in the string file and the values of the dictionary are the values that would be seen in the string file.</span>
<span class="sd">    filename : str</span>
<span class="sd">        Name of the event file (.evt) in which this event is stored.  This attribute is initially empty and is populated by the `write_to_file()` method. </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_SCALAR_PARAMETERS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Units&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Event_Name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Drive_Type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Measurement_Tool&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Start_Depth&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Off_Bottom&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Initial_Drive_Torque&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Motor_Type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Filter_Time_Constant&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Motor_Bend_Start&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Motor_Bend_Ramp&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Mud_Density&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Impact_Damping_Penetration&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Impact_Exponent&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MWD_Pulsing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NperRev&#39;</span><span class="p">,</span>
        <span class="s1">&#39;N&#39;</span><span class="p">,</span>
        <span class="s1">&#39;S_threshold&#39;</span><span class="p">,</span>
        <span class="s1">&#39;C_hi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Plotting_4D&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Start_Time&#39;</span><span class="p">,</span>
        <span class="s1">&#39;End_Time&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Plotting_Interval&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Start_Distance&#39;</span><span class="p">,</span>
        <span class="s1">&#39;End_Distance&#39;</span>
    <span class="p">]</span>
    
    <span class="n">_DEFAULT_PARAMETER_SCALARS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Units&#39;</span><span class="p">:</span> <span class="s1">&#39;Imperial&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Drive_Type&#39;</span><span class="p">:</span> <span class="s1">&#39;WITH_MOTOR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Measurement_Tool&#39;</span><span class="p">:</span> <span class="s1">&#39;TOS&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Initial_Drive_Torque&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;Motor_Type&#39;</span><span class="p">:</span> <span class="s1">&#39;3D&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Filter_Time_Constant&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="s1">&#39;Motor_Bend_Start&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s1">&#39;Motor_Bend_Ramp&#39;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">,</span>
        <span class="s1">&#39;Mud_Density&#39;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="s1">&#39;Impact_Damping_Penetration&#39;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
        <span class="s1">&#39;Impact_Exponent&#39;</span><span class="p">:</span> <span class="mf">1.05</span><span class="p">,</span>
        <span class="s1">&#39;MWD_Pulsing&#39;</span><span class="p">:</span> <span class="s1">&#39;On&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NperRev&#39;</span><span class="p">:</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span>
        <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;S_threshold&#39;</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">,</span>
        <span class="s1">&#39;C_hi&#39;</span><span class="p">:</span> <span class="mf">1.05</span><span class="p">,</span>
        <span class="s1">&#39;Plotting_4D&#39;</span><span class="p">:</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Start_Time&#39;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span>
        <span class="s1">&#39;End_Time&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">&#39;Plotting_Interval&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">&#39;Start_Distance&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="s1">&#39;End_Distance&#39;</span><span class="p">:</span> <span class="mf">100.0</span>
    <span class="p">}</span>

    <span class="n">_TABLE_PARAMETERS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;ROTARY_RPM&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MOTOR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;FLOW_RATE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;WOB&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ROP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NPERREV&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DYNAMICS&#39;</span>
    <span class="p">]</span>

    <span class="n">_DEFAULT_PARAMETER_TABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ROTARY_RPM&#39;</span><span class="p">:</span> <span class="p">((),(),()),</span>
        <span class="s1">&#39;MOTOR&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;FLOW_RATE&#39;</span><span class="p">:</span> <span class="p">((),(),()),</span>
        <span class="s1">&#39;WOB&#39;</span><span class="p">:</span> <span class="p">((),(),()),</span>
        <span class="s1">&#39;ROP&#39;</span><span class="p">:</span> <span class="p">((),(),()),</span>
        <span class="s1">&#39;NPERREV&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,),(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;DYNAMICS&#39;</span><span class="p">:</span> <span class="p">((),</span> <span class="p">())</span>
    <span class="p">}</span>

    <span class="n">_CDB_TABLE</span> <span class="o">=</span> <span class="s1">&#39;events.tbl&#39;</span>
    <span class="n">_EXT</span> <span class="o">=</span> <span class="s1">&#39;evt&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">start_depth</span><span class="p">,</span> <span class="n">off_bottom</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the :class:`DrillEvent` class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event_name : str</span>
<span class="sd">            Name of the event.</span>
<span class="sd">        start_depth : float</span>
<span class="sd">            Start depth of the event in feet.</span>
<span class="sd">        off_bottom : float</span>
<span class="sd">            Starting distance from bottom.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Event_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Start_Depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Off_Bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">off_bottom</span>        
        
        <span class="c1"># Apply default parameters                </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_defaults</span><span class="p">()</span>    

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<div class="viewcode-block" id="DrillEvent.add_simulation_step"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.event.DrillEvent.add_simulation_step">[docs]</a>    <span class="k">def</span> <span class="nf">add_simulation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">output_step_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">clear_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a dynamic simulation step.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        end_time : float</span>
<span class="sd">            End time of the step in seconds.</span>
<span class="sd">        output_step_size : float</span>
<span class="sd">            Output step size of the step in seconds. (defaults is 0.05)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">clear_existing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;DYNAMICS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[],[]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;DYNAMICS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;DYNAMICS&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_step_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;_DYNAMICS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;DYNAMICS&#39;</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="DrillEvent.add_ramp"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.event.DrillEvent.add_ramp">[docs]</a>    <span class="k">def</span> <span class="nf">add_ramp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">ramp_duration</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">clear_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a ramp to the specified ramp parameter.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameter : str</span>
<span class="sd">            ramp parameter, options are &#39;TOP_DRIVE&#39;, &#39;WOB&#39;, &#39;FLOW_RATE&#39;, or &#39;ROP&#39;</span>
<span class="sd">        start_time : float</span>
<span class="sd">            Start time of the ramp.</span>
<span class="sd">        ramp_duration : float</span>
<span class="sd">            Duration of the ramp.</span>
<span class="sd">        delta : float</span>
<span class="sd">            Delta of the ramp.  Units should be in **rpm**, **lbf**, **gpm**, or **ft/sec**.</span>
<span class="sd">        clear_existing : bool</span>
<span class="sd">            If true, existing ramps for the specified parameter will be deleted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">clear_existing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[],[],[]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ramp_duration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">])</span>  </div>

<div class="viewcode-block" id="DrillEvent.write_to_file"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.event.DrillEvent.write_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates an event file from the DrillEvent object.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Uses file version 1.0</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        write_directory : str</span>
<span class="sd">            Directory in which to write the file. Defaults to current working directory.</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to write.  Defaults to self.parameters[&#39;EVENT_NAME&#39;]</span>
<span class="sd">        cdb : str</span>
<span class="sd">            Name of the cdb in which to write the file.  This argument overrides the write_directory.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised if not all parameters have been defined.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Raise an error if the parameters can&#39;t be validated</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The parameters could not be validated.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If the write_directory argument is passed</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># If the filename argument is not passed, set the filename</span>
                <span class="c1"># as the Event_Name in the file</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Event_Name&#39;</span><span class="p">]</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the filename argument is passed, strip the path and the </span>
                <span class="c1"># extension</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;.</span><span class="si">{self._EXT}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
            <span class="c1"># Set the filepath to the filename in the given directory</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{filename}</span><span class="s1">.</span><span class="si">{self._EXT}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cdb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If the write_directory argument is not passed, but the cdb</span>
            <span class="c1"># argument is</span>

            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># If the filename argument is not passed, set the filename</span>
                <span class="c1"># as the Event_Name in the file</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Event_Name&#39;</span><span class="p">]</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the filename argument is passed, strip the path and the </span>
                <span class="c1"># extension</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;.</span><span class="si">{self._EXT}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
            <span class="c1"># Set the filepath to the file in the cdb</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">get_full_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;&lt;</span><span class="si">{cdb}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CDB_TABLE</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{filename}</span><span class="s1">.</span><span class="si">{self._EXT}</span><span class="s1">&#39;</span><span class="p">))</span>
        
        <span class="k">elif</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If the filename argument is given</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">thornpy</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">convert_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Raise an error if none of the arguments are provided</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Ether directory, filename, or cdb must be passed.&#39;</span><span class="p">)</span>  
                      
        <span class="n">event_template</span> <span class="o">=</span> <span class="n">TMPLT_ENV</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;templates&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;template.</span><span class="si">{self._EXT}</span><span class="s1">&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">event_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">get_cdb_path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span></div>
    
<div class="viewcode-block" id="DrillEvent.validate"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.event.DrillEvent.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines if all parameters have been set</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if all parameters have been set. Otherwise `False`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="kc">True</span>        
        <span class="c1"># Check that all parameters exist in the self.parameters dictionary</span>
        <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SCALAR_PARAMETERS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> not found in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">validated</span> <span class="o">=</span> <span class="kc">False</span>        
        
        <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TABLE_PARAMETERS</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]]):</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> not found in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">validated</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="k">return</span> <span class="n">validated</span>          </div>

<div class="viewcode-block" id="DrillEvent.read_from_file"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.event.DrillEvent.read_from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads an Adams Drill event (.evt) file and sets :attr:`DrillEvent.parameters` based on data in the file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Filename of an Adams Drill event (.evt) file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Read the TO data into a dictionary</span>
        <span class="n">tiem_orbit_data</span> <span class="o">=</span> <span class="n">read_TO_file</span><span class="p">(</span><span class="n">get_full_path</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="c1"># Create an empty event object</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># Extract the DrillEvent parameters from the TO dictionary        </span>
        <span class="n">event</span><span class="o">.</span><span class="n">_get_params_from_TO_data</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">)</span> <span class="c1">#pylint: disable=protected-access</span>
        
        <span class="c1"># Set the filename attribute</span>
        <span class="n">event</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="n">event</span></div>

    <span class="k">def</span> <span class="nf">_apply_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies defaults from class variables</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Applies normal parameter defaults</span>
        <span class="k">for</span> <span class="n">scalar_parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_PARAMETER_SCALARS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">scalar_parameter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">scalar_parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Applies defaults to all ramp parameters</span>
        <span class="k">for</span> <span class="n">table_parameter</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_PARAMETER_TABLES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">table_parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">table</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">table_parameter</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">table_parameter</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">_get_params_from_TO_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiem_orbit_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the event parameters out of a dictoinary of Tiem Orbit data generated by :func:`adamspy.adripy.utilities.read_TO_file`</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Adams 2018 uses *delta* values for the surface parameters where as Adams 2019 uses *at end* values.  :class:`DrillEvent` always uses *delta* values, so any *at end* values are converted in this method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tiem_orbit_data : dict</span>
<span class="sd">            Dictionary of Tiem Orbit data</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            An event parameter could not be found</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_version</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">[</span><span class="s1">&#39;ADAMS_DRILL_HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;file_version&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SCALAR_PARAMETERS</span><span class="p">:</span>
            <span class="c1"># For each event parameter initialize a found flag</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">:</span>
                <span class="c1"># For each block in the TO file</span>

                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time&#39;</span><span class="p">]:</span>
                    <span class="c1"># If finding the End_Time, or Start_Time parameters, only look in the PLOT_4D block</span>
                    <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;plot_4d&#39;</span><span class="p">:</span>                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">]:</span>
                    <span class="c1"># If the parameter is in this block, set the parameter and break the loop</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;end_time&#39;</span><span class="p">:</span>
                    <span class="c1"># If the parameter is not in this block, find all the sub blocks </span>
                    <span class="c1"># and look for the parameter inside each sub block</span>
                    <span class="n">sub_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">header</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)]</span>
                    
                    <span class="k">for</span> <span class="n">sub_block</span> <span class="ow">in</span> <span class="n">sub_blocks</span><span class="p">:</span>
                        <span class="c1"># For each sub_block in the block</span>

                        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">sub_block</span><span class="p">]:</span>
                            <span class="c1"># If the parameter is in the sub block, set the parameter and break the loop</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">sub_block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
                    
                    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                        <span class="k">break</span>
            
            <span class="c1"># Raise a value error if the parameter isn&#39;t found.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{param}</span><span class="s1"> not found!&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TABLE_PARAMETERS</span><span class="p">:</span>
            <span class="c1"># For each event parameter initialize a found flag</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">header</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)]</span>
        
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
                <span class="c1"># For each block in the TO file, get the sub blocks</span>
                <span class="n">sub_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">header</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)]</span>
                
                <span class="c1"># vvvvvvvvvvvv This is a bandaid to make this code backward compatible vvvvvvvvvvvv</span>
                <span class="k">if</span> <span class="s1">&#39;TOP_DRIVE&#39;</span> <span class="ow">in</span> <span class="n">sub_blocks</span><span class="p">:</span>                    
                    <span class="c1"># Replace &#39;TOP_DRIVE&#39; with &#39;ROTARY_RPM&#39;</span>
                    <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">sub_blocks</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TOP_DRIVE&#39;</span><span class="p">:</span>
                            <span class="n">sub_blocks</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ROTARY_RPM&#39;</span>
                            <span class="k">break</span>                   

                    <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;ROTARY_RPM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;TOP_DRIVE&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;PUMP_FLOW&#39;</span> <span class="ow">in</span> <span class="n">sub_blocks</span><span class="p">:</span>                    
                    <span class="c1"># Replace &#39;PUMP_FLOW&#39; with &#39;FLOW_RATE&#39;</span>
                    <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">sub_blocks</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PUMP_FLOW&#39;</span><span class="p">:</span>
                            <span class="n">sub_blocks</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FLOW_RATE&#39;</span>
                            <span class="k">break</span>                   

                    <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;FLOW_RATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;PUMP_FLOW&#39;</span><span class="p">)</span>
                
                <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="n">block</span> <span class="ow">and</span> <span class="n">block</span><span class="o">==</span><span class="s1">&#39;DYNAMICS&#39;</span><span class="p">:</span>
                    <span class="c1"># If the parameter is DYNAMICS and so is the current block</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;output_step_size&#39;</span><span class="p">]</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="n">block</span> <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="c1"># If the current parameter is the block, add to the parameters dictionary</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;ramp_duration&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">last_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span><span class="s1">&#39;ramp_duration&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">last_col</span><span class="p">]</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
                
                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sub_blocks</span><span class="p">:</span>
                    <span class="c1"># If the current parameter is in this sub block, add to the parameters dictionary</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s1">&#39;ramp_duration&#39;</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                        <span class="c1"># If the .evt file uses *ramp duration* notation, no conversion necessary</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="s1">&#39;ramp_duration&#39;</span><span class="p">]</span>

                    <span class="k">elif</span> <span class="s1">&#39;end_time&#39;</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                        <span class="c1"># If the .evt file uses *at end* notation, convert to *ramp duration* notation</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="k">for</span> <span class="n">end</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="s1">&#39;end_time&#39;</span><span class="p">],</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="s1">&#39;start_time&#39;</span><span class="p">])]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">list_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">par</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="n">par</span><span class="p">],</span> <span class="nb">list</span><span class="p">)]</span>
                        <span class="n">last_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">list_params</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span><span class="s1">&#39;ramp_duration&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                                                
                        <span class="k">if</span> <span class="s1">&#39;delta&#39;</span> <span class="ow">in</span> <span class="n">last_col</span><span class="p">:</span>
                            <span class="c1"># If .evt file uses 2018 notation (delta)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="n">last_col</span><span class="p">]</span>
                        
                        <span class="k">elif</span> <span class="s1">&#39;at_end&#39;</span> <span class="ow">in</span> <span class="n">last_col</span><span class="p">:</span>
                            <span class="c1"># If .evt file uses 2019 notation (value at end)</span>
                            <span class="n">at_end_values</span> <span class="o">=</span> <span class="n">tiem_orbit_data</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="n">last_col</span><span class="p">]</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">at_end_values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>                                
                                <span class="c1"># If there is only one value (the delta and the end value are the same)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">at_end_values</span>
                            
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># If there are multiple values, calculate the deltas                                </span>
                                <span class="c1"># The first &quot;delta&quot; value is the same as the first &quot;at end&quot; value</span>
                                <span class="n">delta_values</span> <span class="o">=</span> <span class="n">at_end_values</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

                                <span class="c1"># Loop over the &quot;at end&quot; values to calculate the &quot;delta&quot; values</span>
                                <span class="k">for</span> <span class="n">at_end_value</span><span class="p">,</span> <span class="n">prev_at_end_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">at_end_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">at_end_values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                                    <span class="n">delta_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at_end_value</span> <span class="o">-</span> <span class="n">prev_at_end_value</span><span class="p">)</span>

                                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_values</span>
                        
                        <span class="c1"># Check if need to convert wob from klbf to lbf</span>
                        <span class="k">if</span> <span class="n">file_version</span> <span class="o">&gt;=</span> <span class="mf">2.0</span> <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;wob&#39;</span><span class="p">:</span>
                            <span class="c1"># If this is a file version 2.0 and the parameter is wob, convert from klbf to lbf</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>

                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{param}</span><span class="s1"> not found!&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ben Thornton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>