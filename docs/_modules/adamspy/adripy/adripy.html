

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>adamspy.adripy.adripy &mdash; adamspy 0.7.53 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> adamspy
          

          
          </a>

          
            
            
              <div class="version">
                0.7.53
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">adamspy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>adamspy.adripy.adripy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for adamspy.adripy.adripy</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;adripy contains functions for manipulating MSC Adams Drill files</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">environ</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">remove</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">rename</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">thornpy</span>
<span class="kn">import</span> <span class="nn">jinja2</span>

<span class="c1"># Define regular expressions</span>
<span class="n">TO_PARAMETER_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^ [_0-9a-zA-Z]+</span><span class="se">\\</span><span class="s1">s+=</span><span class="se">\\</span><span class="s1">s+((</span><span class="se">\&#39;</span><span class="s1">[-:_0-9a-zA-Z&lt;&gt;</span><span class="se">\\\\</span><span class="s1">/</span><span class="se">\\</span><span class="s1">.]+</span><span class="se">\&#39;</span><span class="s1">)|(-?[</span><span class="se">\\</span><span class="s1">+-</span><span class="se">\\</span><span class="s1">.e0-9]+))</span><span class="se">\\</span><span class="s1">s*$&#39;</span><span class="p">)</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">PackageLoader</span><span class="p">(</span><span class="s1">&#39;adamspy.adripy&#39;</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
    <span class="n">autoescape</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">select_autoescape</span><span class="p">([</span><span class="s1">&#39;evt&#39;</span><span class="p">,</span><span class="s1">&#39;str&#39;</span><span class="p">]),</span>
    <span class="n">keep_trailing_newline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Test that the user config file exists</span>
<span class="k">if</span> <span class="s1">&#39;ADRILL_USER_CFG&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="c1"># raise EnvironmentError(&#39;ADRILL_USER_CFG environment variable is not set!&#39;)</span>
    <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;USERPROFILE&#39;</span><span class="p">],</span> <span class="s1">&#39;.adrill.cfg&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">]):</span>
    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;The configuration file </span><span class="si">{}</span><span class="s1"> does not exist!  You must set the ADRILL_USER_CFG environment variable to an existing cfg file before importing adripy.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">]))</span>

<span class="c1"># Test that the user shared file exists</span>
<span class="k">if</span> <span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>    
    <span class="k">if</span> <span class="s1">&#39;XDG_CACHE_HOME&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_CACHE_HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;adrill&#39;</span><span class="p">,</span> <span class="s1">&#39;adrill.cfg&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;ADRILL_SHARED_CFG environment variable is not set!&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">]):</span>
    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;The configuration file </span><span class="si">{}</span><span class="s1"> does not exist!  You must set the ADRILL_SHARED_CFG environment variable to an existing cfg file before importing adripy.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">]))</span>

<span class="c1"># Test that the adams launch file exists</span>
<span class="k">if</span> <span class="s1">&#39;ADAMS_LAUNCH_COMMAND&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="c1"># raise EnvironmentError(&#39;ADAMS_LAUNCH_COMMAND environment variable is not set!&#39;)</span>
    <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADAMS_LAUNCH_COMMAND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_CACHE_HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;common&#39;</span><span class="p">,</span> <span class="s1">&#39;mdi.bat&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADAMS_LAUNCH_COMMAND&#39;</span><span class="p">]):</span>
    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;The adams launch file </span><span class="si">{}</span><span class="s1"> does not exist!  You must set the ADRILL_SHARED_CFG environment variable to an existing cfg file before importing adripy.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADAMS_LAUNCH_COMMAND&#39;</span><span class="p">]))</span>

<span class="c1"># Dictionary of TO tool length parameters</span>
<span class="n">TO_LENGTH_PARAM</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Accelerator_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;agitator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Body_Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Shock_Stub_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;blade_reamer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Reamer_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;crossover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Crossover_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;dart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dart_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;drill_collar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Drillcollar_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;drillpipe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pipe_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;flex_pipe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Flex_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;generic_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tool_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;generic_short&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GenericShort_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;hw_pipe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pipe_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;instrumentation_sub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ISUB_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;jar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Body_Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Stub_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;mfr_tool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tool_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Motor_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;mwd_tool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tool_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;pdc_bit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bit_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;single_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bit_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;roller_cone_bit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bit_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;shock_sub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Installed_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;short_collar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Collar_Length&#39;</span><span class="p">]</span>
<span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="s1">&#39;stabilizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Stabilizer_Length&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="turn_measure_on"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.turn_measure_on">[docs]</a><span class="k">def</span> <span class="nf">turn_measure_on</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="n">tool_types</span><span class="o">=</span><span class="p">[],</span> <span class="n">tool_numbers</span><span class="o">=</span><span class="p">[],</span> <span class="n">tool_names</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;Modify a string file to turn measure on for teh designated tools.  Tools may be designated by type, number (stack order), or name.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an MSC Adams Drill string file (include the .str extension)</span>
<span class="sd">    tool_types : list, optional</span>
<span class="sd">        List of tool types as seen in the string file (e.g. pdc_bit, motor, stabilizer)</span>
<span class="sd">    tool_numbers : list, optional</span>
<span class="sd">        List of stack orders corresponding to tools in the string</span>
<span class="sd">    tool_names : list, optional</span>
<span class="sd">        List of tool names</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        number of tools measured</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mark</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_str</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_str_tmp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="c1"># If this is a measure line that has been marked</span>
            <span class="k">elif</span> <span class="n">mark</span> <span class="ow">and</span> <span class="s1">&#39; measure&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Measure  =  &#39;yes&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">mark</span> <span class="o">=</span> <span class="kc">False</span>
                            
            <span class="c1"># Mark if the tool matches a designated stack order</span>
            <span class="k">elif</span> <span class="s1">&#39; stack_order&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">tool_numbers</span><span class="p">:</span>
                    <span class="n">mark</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
            <span class="c1"># Mark if the tool matches a designated tool type</span>
            <span class="k">elif</span> <span class="s1">&#39; type&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tool_types</span><span class="p">:</span>
                    <span class="n">mark</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
            <span class="c1"># Mark if the tool matches a designated tool name</span>
            <span class="k">elif</span> <span class="s1">&#39; name&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tool_names</span><span class="p">:</span>
                    <span class="n">mark</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="n">remove</span><span class="p">(</span><span class="n">string_file</span><span class="p">)</span>
    <span class="n">rename</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span> <span class="n">string_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="get_tool_name"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_tool_name">[docs]</a><span class="k">def</span> <span class="nf">get_tool_name</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="n">tool_type</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_full_path</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the name, filename, stack order, and group name of the `n`th tool of type `tool_type` in `string_file`.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams drill string file (include the .str extension)</span>
<span class="sd">    tool_type : str</span>
<span class="sd">        Tool type as seen in the string file (e.g. pdc_bit, motor, stabilizer)</span>
<span class="sd">    n : int</span>
<span class="sd">        If the string file has multiple tools of type `tool_type` , returns the `n` th tool of that type. (the default is 1)</span>
<span class="sd">    return_full_path : bool</span>
<span class="sd">        If true, returns the full path to the tool file instead of using the Adams Drill database (cdb). (the default is True)</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Raised if a tool of type `tool_type` is not found in `string_file`</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Name of the requested tool</span>
<span class="sd">    str</span>
<span class="sd">        Full filepath the the requested tool\&#39;s property file</span>
<span class="sd">    int</span>
<span class="sd">        Stack order of tool</span>
<span class="sd">    str</span>
<span class="sd">        Tool\&#39;s group name if it has one</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tool_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tool_type</span> <span class="o">==</span> <span class="s1">&#39;hole&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39; Hole_Property_File  =  &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">tool_file</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="n">tool_name</span>
                <span class="k">if</span> <span class="n">return_full_path</span><span class="p">:</span>
                    <span class="n">tool_file</span> <span class="o">=</span> <span class="n">get_toolFilename_fullNotation</span><span class="p">(</span><span class="n">tool_file</span><span class="p">)</span>
                <span class="n">tool_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">stack_order</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39; stack_order&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">stack_order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="n">n</span> <span class="ow">and</span> <span class="s1">&#39; name &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="n">n</span> <span class="ow">and</span> <span class="s1">&#39; property_file&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">tool_file</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">return_full_path</span><span class="p">:</span>
                    <span class="n">tool_file</span> <span class="o">=</span> <span class="n">get_toolFilename_fullNotation</span><span class="p">(</span><span class="n">tool_file</span><span class="p">)</span>
                <span class="n">tool_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="s1">&#39; type &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">tool_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">tool_found</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_file</span><span class="p">,</span> <span class="n">stack_order</span><span class="p">,</span> <span class="n">group_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Tool of type </span><span class="si">{}</span><span class="s1"> not found in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool_type</span><span class="p">,</span> <span class="n">string_file</span><span class="p">))</span></div>

<div class="viewcode-block" id="get_toolFilename_fullNotation"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_toolFilename_fullNotation">[docs]</a><span class="k">def</span> <span class="nf">get_toolFilename_fullNotation</span><span class="p">(</span><span class="n">toolFilename_cdbNotation</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">toolFilename_cdbNotation</span><span class="p">:</span>
        <span class="n">cdb_name</span> <span class="o">=</span> <span class="n">toolFilename_cdbNotation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
            <span class="n">cdb_path</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span>   
            <span class="n">toolFilename_fullNotation</span> <span class="o">=</span> <span class="n">cdb_path</span> <span class="o">+</span> <span class="n">toolFilename_cdbNotation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>                 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">cdbError</span><span class="p">(</span><span class="s1">&#39;ADrill Database </span><span class="si">{}</span><span class="s1"> not defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">toolFilename_fullNotation</span> <span class="o">=</span> <span class="n">toolFilename_cdbNotation</span>
    <span class="k">return</span> <span class="n">toolFilename_fullNotation</span></div>

<div class="viewcode-block" id="get_adrill_cdbs"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_adrill_cdbs">[docs]</a><span class="k">def</span> <span class="nf">get_adrill_cdbs</span><span class="p">(</span><span class="n">adrill_user_cfg</span><span class="p">,</span> <span class="n">adrill_shared_cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the names and locatinos of all user defined MSC Adams Drill databases (cdbs)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    adrill_user_cfg : str</span>
<span class="sd">        Full path to an Adams Drill user configuration file.  This hould be in the users HOME directory.</span>
<span class="sd">    adrill_shared_cfg : str, optional</span>
<span class="sd">        Full path to an Adams Drill shared configuration file.  This should be in the Adams Drill installation directory.  (the default is None, which means that only user cdbs will be returned.)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary in which the cdb names are keys and the cdb locations are values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cdbs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">adrill_user_cfg</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">):</span>
                <span class="c1"># try:</span>
                <span class="n">cdb_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[</span><span class="se">\t</span><span class="s1"> ]+&#39;</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cdb_loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[</span><span class="se">\t</span><span class="s1"> ]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$HOME&#39;</span><span class="p">,</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;USERPROFILE&#39;</span><span class="p">]))</span>
                <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdb_loc</span>
                <span class="c1"># except:</span>
                <span class="c1">#     raise cdbError(&#39;The following line in {} could not be interpreted.\n\n{}&#39;.format(adrill_user_cfg,line))</span>
    <span class="k">if</span> <span class="n">adrill_shared_cfg</span><span class="p">:</span>
        <span class="n">top_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">adrill_shared_cfg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">adrill_shared_cfg</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">):</span>
                    <span class="c1"># try:</span>
                    <span class="n">cdb_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[</span><span class="se">\t</span><span class="s1"> ]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cdb_loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[</span><span class="se">\t</span><span class="s1"> ]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$HOME&#39;</span><span class="p">,</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;USERPROFILE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$topdir&#39;</span><span class="p">,</span><span class="n">top_dir</span><span class="p">))</span>                        
                    <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdb_loc</span>
                    <span class="c1"># except:</span>
                        <span class="c1"># raise cdbError(&#39;The following line in {} could not be interpreted.\n\n{}&#39;.format(adrill_shared_cfg,line))</span>
    <span class="k">return</span> <span class="n">cdbs</span></div>

<div class="viewcode-block" id="get_TO_param"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_TO_param">[docs]</a><span class="k">def</span> <span class="nf">get_TO_param</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">requested_parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the value of a parameter in a tiem orbit file</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Full path to a tiem orbit file</span>
<span class="sd">    requested_parameter : str</span>
<span class="sd">        Name of a parameter in TO_file  </span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str or int or float</span>
<span class="sd">        The value assigned to TO_param in TO_file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if CDB notation used and Convert</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">get_toolFilename_fullNotation</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Initialize a flag indicating that the parameter has not yet</span>
    <span class="c1"># been found</span>
    <span class="n">param_found</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1"># Read in the tiem orbit file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="c1"># For each line in the file, check if we are at a</span>
        <span class="c1"># parameter line</span>
        <span class="k">if</span> <span class="n">TO_PARAMETER_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># If we&#39;re at a parameter line, check if it&#39;s the</span>
            <span class="c1"># requested parameter.</span>
            <span class="p">[</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[</span><span class="se">\\</span><span class="s1">s</span><span class="se">\\</span><span class="s1">n]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">requested_parameter</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="c1"># If we&#39;re at the requested parameter line,</span>
                <span class="c1"># check if it&#39;s an adams string or a number        </span>
                
                <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="c1"># If value is an adams string</span>
                    <span class="n">requested_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If value is a number</span>
                    <span class="n">requested_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">thornpy</span><span class="o">.</span><span class="n">numtype</span><span class="o">.</span><span class="n">str_is_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                
                <span class="c1"># Mark the parameter as found</span>
                <span class="n">param_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="n">param_found</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">requested_value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> does not contain the parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">requested_parameter</span><span class="p">))</span></div>


<div class="viewcode-block" id="has_tool"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.has_tool">[docs]</a><span class="k">def</span> <span class="nf">has_tool</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="n">tool_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns true if string_file has at least one tool of type tool_type</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>
<span class="sd">    tool_type : str</span>
<span class="sd">        Adams Drill tool type</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if string_file contains at least one tool of type tool_type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tool_type_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39; Type  =  &#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">tool_type</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">tool_type_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tool_type_found</span></div>

<div class="viewcode-block" id="fullNotation_to_cdbNotation"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.fullNotation_to_cdbNotation">[docs]</a><span class="k">def</span> <span class="nf">fullNotation_to_cdbNotation</span><span class="p">(</span><span class="n">string_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces all references in a string file that use full path notation to use CDB notation</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Number of replacements made</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> 

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_str</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_str_tmp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_str</span><span class="p">:</span>
            <span class="n">cdb_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s1">&#39;property_file&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">cdb_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">],</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">elif</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">cdb_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">elif</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">cdb_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">cdb_found</span><span class="p">:</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="n">remove</span><span class="p">(</span><span class="n">string_file</span><span class="p">)</span>
    <span class="n">rename</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span> <span class="n">string_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="cdbNotation_to_fullNotation"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.cdbNotation_to_fullNotation">[docs]</a><span class="k">def</span> <span class="nf">cdbNotation_to_fullNotation</span><span class="p">(</span><span class="n">string_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Replaces all references in a string file that use CDB notation to use full path notation</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Number of replacements made</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> 

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_str</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_str_tmp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_str</span><span class="p">:</span>
            <span class="n">cdb_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s1">&#39;property_file&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">cdb_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">),</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">cdb_found</span><span class="p">:</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid_str_tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="n">remove</span><span class="p">(</span><span class="n">string_file</span><span class="p">)</span>
    <span class="n">rename</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span> <span class="n">string_file</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="get_cdb_path"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_cdb_path">[docs]</a><span class="k">def</span> <span class="nf">get_cdb_path</span><span class="p">(</span><span class="n">full_filepath</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;Given the full path to a file located in a cdb, get_cdb_path returns the path to a</span>
<span class="sd">    file with the cdb path replaced by the cdb alias.  full_filepath will be returned if</span>
<span class="sd">    no cdb is found in the path.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    full_filepath : str</span>
<span class="sd">        Full file path to a file in a cdb</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Path to a file with the cdb path replaced by the cdb alias.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdb_filepath</span> <span class="o">=</span> <span class="n">full_filepath</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span> <span class="ow">in</span> <span class="n">full_filepath</span><span class="p">:</span>
            <span class="n">cdb_filepath</span> <span class="o">=</span> <span class="n">full_filepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">],</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">full_filepath</span><span class="p">:</span>
            <span class="n">cdb_filepath</span> <span class="o">=</span> <span class="n">full_filepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">full_filepath</span><span class="p">:</span>
            <span class="n">cdb_filepath</span> <span class="o">=</span> <span class="n">full_filepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cdb_filepath</span></div>

<div class="viewcode-block" id="get_full_path"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_full_path">[docs]</a><span class="k">def</span> <span class="nf">get_full_path</span><span class="p">(</span><span class="n">cdb_filepath</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;Given the cdb path to a file located in a cdb, get_full_path returns the path to a</span>
<span class="sd">    file with the cdb alias replaced by the cdb location.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cdb_filepath : str</span>
<span class="sd">        Full file path to a file in a cdb</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Path to a file with the cdb path replaced by the cdb alias.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># Find a string that looks like a database alias</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;^&lt;.+&gt;&#39;</span><span class="p">,</span> <span class="n">cdb_filepath</span><span class="p">)</span>
    
    <span class="c1"># Return the given filepath if filepath looks like a full filepath</span>
    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cdb_filepath</span>
    
    <span class="c1"># Pull the database name out of the group</span>
    <span class="n">cdb_name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Get a dictionar of the known cdbs</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    
    <span class="c1"># Raise an error if cdb_name is not in the cdbs dictionary</span>
    <span class="k">if</span> <span class="n">cdb_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> not in </span><span class="si">{}</span><span class="s1"> OR </span><span class="si">{}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">]))</span>
    
    <span class="n">full_filepath</span> <span class="o">=</span> <span class="n">cdb_filepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">full_filepath</span></div>

<div class="viewcode-block" id="get_cdb_location"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_cdb_location">[docs]</a><span class="k">def</span> <span class="nf">get_cdb_location</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the location of cdb &#39;cdb_name&#39;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cdb_name : str</span>
<span class="sd">        Alias of a cdb</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Location of cdb</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="replace_tool"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.replace_tool">[docs]</a><span class="k">def</span> <span class="nf">replace_tool</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="n">old_tool_file</span><span class="p">,</span> <span class="n">new_tool_file</span><span class="p">,</span> <span class="n">old_tool_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">new_tool_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Swaps old_tool_file for new_tool_file in string_file.  Also replaces the tools Name field.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>
<span class="sd">    old_tool_file : str</span>
<span class="sd">        Path to an Adams Drill tool property file that exists in string_file. May use full path or Adrill CDB notation.</span>
<span class="sd">    new_tool_file : str</span>
<span class="sd">        Path to an Adams Drill tool property file to replace old_tool_file. May use full path or Adrill CDB notation.</span>
<span class="sd">    N : int</span>
<span class="sd">        Number of replacements to make. Default is 0 which will replace all instances.</span>
<span class="sd">    old_tool_name : str</span>
<span class="sd">        Name of the tool to replace. Default is the filename.</span>
<span class="sd">    new_tool_name : str</span>
<span class="sd">        Name of the new tool.  Default is the filename.</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Number of replacements that were made</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_tool_file</span> <span class="o">=</span> <span class="n">old_tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">new_tool_file</span> <span class="o">=</span> <span class="n">new_tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get cdb associated with old_tool_file</span>
    <span class="n">old_tool_has_cdb</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">old_tool_file</span> <span class="ow">or</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">old_tool_file</span><span class="p">:</span>
            <span class="n">old_cdb_name</span> <span class="o">=</span> <span class="n">cdb_name</span>
            <span class="n">old_cdb_loc</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">old_tool_has_cdb</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    
    <span class="c1"># If old_tool_file uses cdb notation then change it to full path notation</span>
    <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">old_tool_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">old_tool_has_cdb</span><span class="p">:</span>
            <span class="n">old_tool_file</span> <span class="o">=</span> <span class="n">old_tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_cdb_name</span><span class="p">),</span> <span class="n">old_cdb_loc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">cdbError</span><span class="p">(</span><span class="s1">&#39;ADrill Database </span><span class="si">{}</span><span class="s1"> not defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
                
    <span class="c1"># Get cdb associated with new_tool_file</span>
    <span class="n">new_tool_has_cdb</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_tool_file</span> <span class="ow">or</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_tool_file</span><span class="p">:</span>
            <span class="n">new_cdb_name</span> <span class="o">=</span> <span class="n">cdb_name</span>
            <span class="n">new_cdb_loc</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">new_tool_has_cdb</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    
    <span class="c1"># If new_tool_file uses cdb notation then change it to full path notation</span>
    <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">new_tool_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">new_tool_has_cdb</span><span class="p">:</span>
            <span class="n">new_tool_file</span> <span class="o">=</span> <span class="n">new_tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_cdb_name</span><span class="p">),</span> <span class="n">new_cdb_loc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">cdbError</span><span class="p">(</span><span class="s1">&#39;ADrill Database </span><span class="si">{}</span><span class="s1"> not defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">old_tool_name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">old_tool_name</span> <span class="o">=</span> <span class="n">old_tool_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">new_tool_name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">new_tool_name</span> <span class="o">=</span> <span class="n">new_tool_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Open the original string file for reading and a new string file for writing</span>
    <span class="n">fid_oldString</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fid_newString</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="c1"># Initiate the number of replacements made</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># If the tool is a hole</span>
    <span class="k">if</span> <span class="n">old_tool_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.hol&#39;</span><span class="p">):</span>
        <span class="c1"># Loop through the string file to find the hole property file line</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_oldString</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39; Hole_Property_File  =  &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">new_tool_has_cdb</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_tool_file</span><span class="p">:</span>
                            <span class="n">new_cdb_name</span> <span class="o">=</span> <span class="n">cdb_name</span>
                            <span class="n">new_cdb_loc</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="n">new_tool_file</span> <span class="o">=</span> <span class="n">new_tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new_cdb_loc</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">new_cdb_name</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
                <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Hole_Property_File  =  &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_tool_file</span><span class="p">))</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="c1"># If the tool is not a hole</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Loop through the string file to find and replace the corresponding tool block</span>
        <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_oldString</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39; Type&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                <span class="n">tool_type</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39; Stack_Order&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                <span class="n">stack_order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot; Name  =  &#39;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_tool_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="n">N</span> <span class="ow">or</span> <span class="n">N</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot; Name  =  &#39;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:02d}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_tool_name</span><span class="p">,</span><span class="n">stack_order</span><span class="p">)</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Name  =  &#39;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:02d}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_tool_name</span><span class="p">,</span> <span class="n">stack_order</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Name  =  &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_tool_name</span><span class="p">))</span>
                <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39; Property_File&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">replace</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                <span class="c1"># Check if line uses cdb notation and replace file path with cdb name</span>
                <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">new_tool_has_cdb</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_tool_file</span><span class="p">:</span>
                            <span class="n">new_cdb_name</span> <span class="o">=</span> <span class="n">cdb_name</span>
                            <span class="n">new_cdb_loc</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="n">new_tool_file</span> <span class="o">=</span> <span class="n">new_tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new_cdb_loc</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">new_cdb_name</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
                <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Property_File  =  &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_tool_file</span><span class="p">))</span>
                <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid_newString</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Close the string files, delete the original one, and rename the new one</span>
    <span class="n">fid_oldString</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">fid_newString</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">string_file</span><span class="p">)</span>
    <span class="n">rename</span><span class="p">(</span><span class="n">string_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">,</span><span class="s1">&#39;.tmp&#39;</span><span class="p">),</span> <span class="n">string_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="get_string_length"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_string_length">[docs]</a><span class="k">def</span> <span class="nf">get_string_length</span><span class="p">(</span><span class="n">string_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the total length of the drill string defined in `string_file`</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>
<span class="sd">                      </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    string_length : str</span>
<span class="sd">        Cumulative length of the string    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    <span class="c1"># print(cdbs)</span>
    <span class="n">tool_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fid_string</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_string</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39; property_file&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
            <span class="n">tool_file</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">tool_file</span><span class="p">:</span>
                <span class="c1"># Get cdb associated with tool_file</span>
                <span class="n">tool_has_cdb</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tool_file</span><span class="p">:</span>
                        <span class="n">tool_cdb_name</span> <span class="o">=</span> <span class="n">cdb_name</span>
                        <span class="n">cdb_loc</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">tool_has_cdb</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>  
                <span class="c1"># Change cdb notation to full path notation</span>
                <span class="k">if</span> <span class="n">tool_has_cdb</span><span class="p">:</span>
                    <span class="n">tool_file</span> <span class="o">=</span> <span class="n">tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool_cdb_name</span><span class="p">),</span> <span class="n">cdb_loc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">cdbError</span><span class="p">(</span><span class="s1">&#39;ADrill Database </span><span class="si">{}</span><span class="s1"> not defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
            <span class="n">fid_tool</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tool_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_tool</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file_type</span> <span class="ow">and</span> <span class="s1">&#39;top_drive&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                    <span class="n">tool_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">tool_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_length</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="s1">&#39; file_type&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                    <span class="n">file_type</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fid_tool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39; number_of_joints&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tool_lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
    <span class="n">fid_string</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">string_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tool_lengths</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string_length</span></div>

<div class="viewcode-block" id="get_number_of_tools"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_number_of_tools">[docs]</a><span class="k">def</span> <span class="nf">get_number_of_tools</span><span class="p">(</span><span class="n">string_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the total number of tools in a string.  Tools for which quantitiiy can be defined are only counted once.  The top drive is not included</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>
<span class="sd">                      </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Number of tools  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; stack_order &#39;</span><span class="p">):</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">num</span></div>

<div class="viewcode-block" id="get_bha_length"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.get_bha_length">[docs]</a><span class="k">def</span> <span class="nf">get_bha_length</span><span class="p">(</span><span class="n">string_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the total length of the drill string defined in string_file NOT including the equivalent upper string and highest most physical string</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string_file : str</span>
<span class="sd">        Full path to an Adams Drill string file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Cumulative length of the string    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="n">get_adrill_cdbs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_SHARED_CFG&#39;</span><span class="p">])</span>
    <span class="c1"># print(cdbs)</span>
    <span class="n">tool_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid_string</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_string</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39; property_file&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                <span class="n">tool_file</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">tool_file</span><span class="p">:</span>
                    <span class="c1"># Get cdb associated with tool_file</span>
                    <span class="n">tool_has_cdb</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tool_file</span><span class="p">:</span>
                            <span class="n">tool_cdb_name</span> <span class="o">=</span> <span class="n">cdb_name</span>
                            <span class="n">cdb_loc</span> <span class="o">=</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">tool_has_cdb</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>  
                    <span class="c1"># Change cdb notation to full path notation</span>
                    <span class="k">if</span> <span class="n">tool_has_cdb</span><span class="p">:</span>
                        <span class="n">tool_file</span> <span class="o">=</span> <span class="n">tool_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool_cdb_name</span><span class="p">),</span> <span class="n">cdb_loc</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">cdbError</span><span class="p">(</span><span class="s1">&#39;ADrill Database </span><span class="si">{}</span><span class="s1"> not defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">))</span>
                <span class="n">fid_tool</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tool_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid_tool</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file_type</span> <span class="ow">and</span> <span class="s1">&#39;top_drive&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">TO_LENGTH_PARAM</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                        <span class="n">tool_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">tool_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_length</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="s1">&#39; file_type&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">):</span>
                        <span class="n">file_type</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fid_tool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39; number_of_joints&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">tool_lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
    <span class="n">string_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tool_lengths</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">string_length</span></div>
    
<div class="viewcode-block" id="add_cdb_to_cfg"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.add_cdb_to_cfg">[docs]</a><span class="k">def</span> <span class="nf">add_cdb_to_cfg</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">cfg_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds cdb of name `name` and path `loc` to `cfg_file`</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of cdb (e.g. example_database)</span>
<span class="sd">    loc : str</span>
<span class="sd">        path to cdb (e.g. C:\\example_database.cdb)</span>
<span class="sd">    cfg_file : str</span>
<span class="sd">        Full filename of an adams drill configuration file</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Raised if a cdb of the given name or path already exists in the given config file</span>
<span class="sd">    PermissionError</span>
<span class="sd">        Raised if the user does not have permissiosn to edit the given config file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Read config file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># Pull cdbs from config file into a dictionary</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;database&#39;</span><span class="p">):</span>
            <span class="n">splt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[ </span><span class="se">\t</span><span class="s1">]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">cdbs</span><span class="p">[</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="c1"># Check if cdb name already exists</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> already exists in </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cfg_file</span><span class="p">))</span>
    
    <span class="c1"># Check if cdb location already exists</span>
    <span class="k">for</span> <span class="n">cdb_name</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">loc</span> <span class="ow">is</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">cdb_name</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> already exists in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">cfg_file</span><span class="p">))</span>
    
    <span class="c1"># Add new cdb to cdbs dictionary</span>
    <span class="n">cdbs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc</span>

    <span class="c1"># Rewrite config file with new cdb</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">cdbs_written</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;database&#39;</span><span class="p">):</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">cdbs_written</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cdb_name</span><span class="p">,</span> <span class="n">cdb_loc</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;DATABASE   </span><span class="si">{}</span><span class="s1">   </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">,</span> <span class="n">cdb_loc</span><span class="p">)</span>
                        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">cdbs_written</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="s1">&#39;You do not have permission to edit </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfg_file</span><span class="p">))</span>    </div>

<div class="viewcode-block" id="remove_cdb_from_cfg"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.remove_cdb_from_cfg">[docs]</a><span class="k">def</span> <span class="nf">remove_cdb_from_cfg</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cfg_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes cdb of name `name` from `cfg_file`</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of cdb (e.g. example_database)</span>
<span class="sd">    cfg_file : str</span>
<span class="sd">        Full filename of an adams drill configuration file</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Raised if a cdb of the given name or path already exists in the given config file</span>
<span class="sd">    PermissionError</span>
<span class="sd">        Raised if the user does not have permissiosn to edit the given config file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Initialize cdbs dictionary</span>
    <span class="n">cdbs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Read config file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># Pull cdbs from config file into a dictionary</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;database&#39;</span><span class="p">):</span>
            <span class="n">splt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[ </span><span class="se">\t</span><span class="s1">]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">cdbs</span><span class="p">[</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="c1"># Check if cdb name exists</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> does not exist in </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cfg_file</span><span class="p">))</span>
    
    <span class="c1"># Remove cdb from cdbs dictionary</span>
    <span class="k">del</span> <span class="n">cdbs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="c1"># Rewrite config file with the cdb removed</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">cdbs_written</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;database&#39;</span><span class="p">):</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">cdbs_written</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cdb_name</span><span class="p">,</span> <span class="n">cdb_loc</span> <span class="ow">in</span> <span class="n">cdbs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;DATABASE   </span><span class="si">{}</span><span class="s1">   </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdb_name</span><span class="p">,</span> <span class="n">cdb_loc</span><span class="p">)</span>
                        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">cdbs_written</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="s1">&#39;You do not have permission to edit </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfg_file</span><span class="p">))</span>  </div>

<div class="viewcode-block" id="create_cfg_file"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.create_cfg_file">[docs]</a><span class="k">def</span> <span class="nf">create_cfg_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">database_paths</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a cfg file with the databases whose paths are given in the database_paths list. Also sets the ADRILL_USER_CONFIG environment variable equal to filename.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Filename for the new configuration file.</span>
<span class="sd">    database_paths : list</span>
<span class="sd">        List of database paths to include in the configuration file. </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># Create a databases dictionary</span>
    <span class="n">databases</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">database_paths</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.cdb&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">databases</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">})</span>

    <span class="c1"># Get the cfg template</span>
    <span class="n">cfg_template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;template.cfg&#39;</span><span class="p">)</span>
    
    <span class="c1"># Write the new cfg file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cfg_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">databases</span><span class="o">=</span><span class="n">databases</span><span class="p">))</span>
    
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADRILL_USER_CFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="build"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.build">[docs]</a><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="n">solver_settings_file</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">,</span> <span class="n">output_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;Builds adm, acf, and cmd files from string, event, and solver settings files.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str</span>
<span class="sd">        Filename of a drill string (.str) file.</span>
<span class="sd">    solver_settings : str</span>
<span class="sd">        Filename of a solver settings (.ssf) file.</span>
<span class="sd">    working_directory : str</span>
<span class="sd">        Path to the directory to put the adm, acf, and cmd</span>
<span class="sd">    output_name : str</span>
<span class="sd">        Base name of the adm, acf, and cmd files. (the default is none, which redefines the `ouput_name` to be the same as the &#39;OutputName&#39; parameter in the string file)</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># Set the output name  </span>
    <span class="k">if</span> <span class="n">output_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">get_TO_param</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;OutputName&#39;</span><span class="p">)</span>       
    
    
    <span class="c1"># Set the names of the output files</span>
    <span class="n">adm_file</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="s1">&#39;.adm&#39;</span>
    
    <span class="n">acf_file</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="s1">&#39;.acf&#39;</span>
    <span class="n">cmd_file</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="s1">&#39;.cmd&#39;</span>
    
    <span class="c1"># Format the string filename    </span>
    <span class="n">adams_formatted_str_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">get_full_path</span><span class="p">(</span><span class="n">string_file</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    
    <span class="c1"># Set the event filename and solver settings file name (relative paths if in the same directory)    </span>
    <span class="n">event_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">get_TO_param</span><span class="p">(</span><span class="n">string_file</span><span class="p">,</span> <span class="s1">&#39;Event_Property_File&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">event_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">):</span>
        <span class="n">evt_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">event_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">evt_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">event_file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">solver_settings_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">):</span>
        <span class="n">ssf_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">solver_settings_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ssf_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">solver_settings_file</span><span class="p">)</span>

    <span class="c1"># Create aview script</span>
    <span class="n">cmds</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ds TOStart string_cfg_file = &quot;</span><span class="si">{adams_formatted_str_filename}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;adrill build acf ssf=&quot;</span><span class="si">{ssf_name}</span><span class="s1">&quot; evt=&quot;</span><span class="si">{evt_name}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;file adams write file=&quot;</span><span class="si">{adm_file}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;simulation script write_acf sim_script_name = &quot;</span><span class="si">{output_name}</span><span class="s1">&quot; file_name = &quot;</span><span class="si">{acf_file}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;file command write entity_name = &quot;</span><span class="si">{output_name}</span><span class="s1">&quot; file_name = &quot;</span><span class="si">{cmd_file}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;build.cmd&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>			
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                                            
    <span class="c1"># Run adams to generate adm, acf, cmd</span>
    <span class="n">startupinfo</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STARTUPINFO</span><span class="p">()</span>
    <span class="n">startupinfo</span><span class="o">.</span><span class="n">dwFlags</span> <span class="o">|=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STARTF_USESHOWWINDOW</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> aview ru-s b build.cmd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADAMS_LAUNCH_COMMAND&#39;</span><span class="p">]),</span> <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">startupinfo</span><span class="o">=</span><span class="n">startupinfo</span><span class="p">)</span>
    <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>    

    <span class="k">return</span> <span class="n">adm_file</span><span class="p">,</span> <span class="n">acf_file</span><span class="p">,</span> <span class="n">cmd_file</span>        </div>

<div class="viewcode-block" id="cdbError"><a class="viewcode-back" href="../../../adamspy.adripy.html#adamspy.adripy.adripy.cdbError">[docs]</a><span class="k">class</span> <span class="nc">cdbError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ben Thornton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>